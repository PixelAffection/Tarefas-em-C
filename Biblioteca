#include <stdio.h>
#include <string.h>
#include <conio.h>
#include <stdlib.h> /* Função exit*/
#include <ctype.h> /* Função toupper*/
#include <locale.h>

#define ARQ "Dados.Dat" /* Arquivo com os dados*/

#define OP_INSERIR '1'
#define OP_ALTERAR '2'
#define OP_APAGAR  '3'
#define OP_LISTAR '4'
#define OP_PESQUISAR '5'
#define OP_MAIS_ALUGADOS '6'

#define OP_SAIR '0'

#define OP_PESQ_ANO '1'
#define OP_PESQ_TITULO '2'



FILE *fp; /*Variável Global pois é útil ao longo do programa*/

typedef struct
{
	int Dia;
	int Mes;
	int Ano;
}DATA;
 
typedef struct
{
	char codigo[4+1];
	char status=' ';
	DATA DE; // Data de Empréstimo
	DATA DD; // Data de Devolução
}LIVRO;

typedef struct
{
	char titulo[30+1];
	char autores[100+1];
	char assunto[30+1];
	char editora[30+1];
	int ano;
	int edicao;
	int ContExist; 
	int ContEmp;
	char status; 	/*		'*' indica que o registro será apagado		*/	
	LIVRO exemplar[3];
}OBRA;


void Inserir_Obra()
 {
 	OBRA o;
 	Ler_Obra(&o);
 	Adicionar_Obra(o);
 }
 
 
 /* Adiciona uma pessoa ao arquivo*/
void Adicionar_Obra (OBRA o)
{
	fseek(fp,0L, SEEK_END);
	if(fwrite(&p,sizeof(o),1,fp)!=1)
		Mensagem("adicionar Pessoa: Falhou a escrita do registro");
}

void Ler_Obra(OBRA *o)
{
	printf("Título	: ");gets(o->titulo);
	printf("Autores	: ");gets(o->autores);
	printf("Editora	: ");gets(o->editora);
	printf("Ano	: ");scanf("%d",&o->ano);
	printf("Edição	: ");gets(o->edicao;
	printf("Assunto	: ");gets(o->assunto);
	printf("Quantidade de exemplares na biblioteca (0,1,2 ou 3)	: ");scanf("%d",&o->ContExist);
	o->Status=' ';
	fflush(stdin);
}

void Inic()
{
	fp=fopen(ARQ,"r+b"); /*Tentar Abrir*/
	if(fp==NULL)
	{
		fp=fopen(ARQ,"w+b");
		if(fp==NULL)
		{
			fprintf(stderr,"ERRO FATAL: Impossível Criar Arquivo de Dados\n");
			exit(1);
		}
	}
}



char *MainMenu[]={
	"1. Inserir Livro",
	"2. Alterar Livro",
	"3. Apagar Livro",
	"4. Listar Livros na biblioteca",
	"5. Pesquisas",
	"6. Listar livros mais alugados"
	"0. Sair",
	NULL	/* Acabaram as opções*/
};

char *PesqMenu[]={
	"1. Pesquisar por Intervalo  de Ano de Lançamento",
	"2. Pesquisar por Título",
	"0. Voltar",
	NULL	/* Acabaram as opções*/ 	
};






 char Menu(char *Opcoes[])
 {
 	int i;
 	char ch;
 	
 	while(1)
 	{  /*Cls*/
 		printf("\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n");//system("cls");
 		for(i=0;Opcoes[i]!=NULL; i++)
 		printf("\t\t%s\n\n",Opcoes[i]);
 		
 	printf("\n\n\tOpção: ");
 	ch=getchar(); fflush(stdin);
 	for(i=0; Opcoes[i]!=NULL; i++)
 	if(Opcoes[i][0]==ch)
 		return ch;
	 }
 }
 
 
 




int main()
 {
 	setlocale(LC_ALL, "Portuguese");
 	char Opcao;
 	Inic();
 	while((Opcao=Menu(MainMenu))!=OP_SAIR)
 		switch(Opcao)
 		{
 			/*
			 case OP_INSERIR: Inserir_Livro();break;
 			case OP_ALTERAR: Alterar_Livro();break;
 			case OP_APAGAR:  Apagar_Livro(); break;
 			case OP_LISTAR:  Listar(); break;
 			case OP_MAIS_ALUGADOS: MaisAlugados(); break;
 			case OP_PESQUISAR:
 				while((Opcao=Menu(PesqMenu))!=OP_SAIR)
 				switch(Opcao)
 				{
 					case OP_PESQ_ANO:
 						{
 							int n1,n2;
 							printf("Qual o intervalo de anos de lançamento: ");
 							scanf("%d%d",&n1,&n2);fflush(stdin);
 							Pesquisar_Ano(n1,n2);
 							break; 
					 	}
					case OP_PESQ_TITULO:
						{
							char string[BUFSIZ+1];
							printf("Qual o título do livro a Procurar: ");
							gets(string);fflush(stdin);
							Pesquisar_Titulo(string);
						}
				 }*/
		 }
 }
